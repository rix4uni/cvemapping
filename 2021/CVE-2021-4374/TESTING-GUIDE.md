# CVE-2021-4374 Complete Testing Guide

## üìã Prerequisites

- Docker and Docker Compose v2 installed
- Nuclei scanner v3.0+ installed
- curl for verification
- Text editor

## üöÄ Setup Instructions

### Step 1: Start WordPress Environment

```bash
cd CVE-2021-4374-Testing-Package
docker compose up -d
```

Wait 60 seconds for initialization.

### Step 2: Verify WordPress is Running

```bash
curl -I http://localhost:8080
```

Should return: `HTTP/1.1 302 Found`

---

## üß™ Testing Options

### Option A: Mock Endpoint Testing (Without Real Plugin)

#### Create Mock Vulnerable Endpoint

```bash
# Enter WordPress container
docker exec -it cve-2021-4374-testing-package-wordpress-1 bash

# Inside container, run these commands:
mkdir -p /var/www/html/wp-content/plugins/wp-automatic

cat > /var/www/html/wp-content/plugins/wp-automatic/process_form.php << 'EOF'
<?php
// MOCK VULNERABLE ENDPOINT - FOR TESTING ONLY
if ($_SERVER["REQUEST_METHOD"] === "POST") {
    http_response_code(200);
    echo "Settings updated successfully";
    exit;
}
http_response_code(200);
exit;
EOF

chown www-data:www-data /var/www/html/wp-content/plugins/wp-automatic/process_form.php
chmod 644 /var/www/html/wp-content/plugins/wp-automatic/process_form.php

exit
```

#### Verify Mock Endpoint

```bash
curl -I http://localhost:8080/wp-content/plugins/wp-automatic/process_form.php
```

Should return: `HTTP/1.1 200 OK`

### Option B: Real Plugin Testing

1. Complete WordPress installation at http://localhost:8080
2. Login to WordPress admin
3. Go to Plugins ‚Üí Add New ‚Üí Upload Plugin
4. Upload `wp-automatic-3.53.2.zip`
5. Activate the plugin

---

## üîç Running Tests

### Test 1: Basic Detection

```bash
nuclei -t CVE-2021-4374.yaml -u http://localhost:8080
```

### Test 2: Verbose Mode

```bash
nuclei -t CVE-2021-4374.yaml -u http://localhost:8080 -v
```

### Test 3: Debug Mode (Most Important for Validation)

```bash
nuclei -t CVE-2021-4374.yaml -u http://localhost:8080 -debug > debug-output.txt 2>&1
```

### Test 4: JSON Output

```bash
nuclei -t CVE-2021-4374.yaml -u http://localhost:8080 -jsonl > results.jsonl
```

### Test 5: Manual Verification with curl

```bash
curl -v -X POST \
  http://localhost:8080/wp-content/plugins/wp-automatic/process_form.php \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "action=update_settings&wp_automatic_option=test"
```

---

## üìä Expected Results

### With Mock Endpoint (Template Logic Validation)

```
[CVE-2021-4374][dsl-1] [http] [critical] 
http://localhost:8080/wp-content/plugins/wp-automatic/process_form.php

Scan completed. 1 matches found.
```

### With Real Vulnerable Plugin

Same as above, confirms actual vulnerability.

### Without Plugin

```
No results found.
```

This is expected when the plugin is not installed.

---

## üìù Collect Test Results

### Create Test Results Directory

```bash
mkdir test-results
```

### Save All Test Outputs

```bash
# Basic test
nuclei -t CVE-2021-4374.yaml -u http://localhost:8080 > test-results/basic.txt

# Debug output (IMPORTANT for submission)
nuclei -t CVE-2021-4374.yaml -u http://localhost:8080 -debug > test-results/debug.txt 2>&1

# JSON output
nuclei -t CVE-2021-4374.yaml -u http://localhost:8080 -jsonl > test-results/results.jsonl

# Manual curl test
curl -v -X POST \
  http://localhost:8080/wp-content/plugins/wp-automatic/process_form.php \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "action=update_settings&wp_automatic_option=test" \
  > test-results/curl-test.txt 2>&1
```

### Document Environment

```bash
# Create environment info file
cat > test-results/environment.txt << EOF
Test Date: $(date)
Nuclei Version: $(nuclei -version 2>&1 | head -1)
Docker Version: $(docker --version)
WordPress: 5.8
PHP: 7.4.27
Apache: 2.4.51
MySQL: 5.7

Testing Method: [Mock Endpoint / Real Plugin]
Plugin Version: [3.53.2 if real, or "Mock" if simulated]

Notes:
- [Add any relevant notes here]
EOF
```

---

## üßπ Cleanup

### Stop and Remove Everything

```bash
docker compose down -v
```

This removes all containers, networks, and volumes.

---

## üì§ Submission Preparation

### For ProjectDiscovery Team

**Email to**: templates@projectdiscovery.io

**Subject**: CVE-2021-4374 Template Validation Request

**Attach**:
1. `CVE-2021-4374.yaml` (the template)
2. `test-results/debug.txt` (debug output)
3. `test-results/environment.txt` (environment details)
4. This `TESTING-GUIDE.md` (for reference)

**Email Body**:
```
I have created a Nuclei template for CVE-2021-4374 (WordPress Automatic Plugin ‚â§3.53.2).

Testing Status:
- Template syntax: Validated
- Mock endpoint testing: [Success/Pending]
- Real plugin testing: [Success/Pending - awaiting plugin access]

Challenge: WP Automatic is a commercial plugin. I [have/have not] been able 
to obtain version 3.53.2 for complete validation.

Request: Please validate this template with your access to vulnerable plugin versions.

Template follows all contribution guidelines and includes comprehensive metadata.

Files attached:
- CVE-2021-4374.yaml
- debug.txt (test output)
- environment.txt (test environment details)
```

---

## üîß Troubleshooting

### Port 8080 Already in Use

```bash
# Check what's using port 8080
docker ps | grep 8080

# Stop other containers
docker compose down
```

### WordPress Container Won't Start

```bash
# Check logs
docker compose logs wordpress

# Restart
docker compose restart
```

### Endpoint Returns 404

```bash
# Verify file exists
docker exec cve-2021-4374-testing-package-wordpress-1 \
  ls -la /var/www/html/wp-content/plugins/wp-automatic/
```

### Nuclei Not Found

```bash
# Add to PATH
export PATH=$PATH:$HOME/go/bin

# Or use full path
$HOME/go/bin/nuclei -t CVE-2021-4374.yaml -u http://localhost:8080
```

---

## ‚ö†Ô∏è Important Notes

1. **Mock endpoint is for template validation only**
   - Tests template logic and syntax
   - Does NOT test actual vulnerability
   - Document this clearly in submission

2. **Real plugin validation is ideal**
   - Confirms actual vulnerability detection
   - Required for final approval
   - ProjectDiscovery team can help with this

3. **Commercial plugin considerations**
   - WP Automatic requires purchase (~$69)
   - Old versions may not be available
   - Contact vendor for research access
   - Or request ProjectDiscovery validation

---

## üìß Contact Plugin Vendor

**Email**: support@valvepress.com

**Subject**: Security Research - Access to WP Automatic v3.53.2

**Body**: See `VENDOR-CONTACT-EMAIL.txt`

---

## üéØ Summary

**Quick Commands**:
```bash
# Setup
docker compose up -d
sleep 60

# Test (after creating mock or installing plugin)
nuclei -t CVE-2021-4374.yaml -u http://localhost:8080 -debug

# Cleanup
docker compose down -v
```

**Success Criteria**:
- ‚úÖ Template detects mock/vulnerable endpoint
- ‚úÖ No false positives on normal WordPress
- ‚úÖ Clean debug output
- ‚úÖ Ready for submission


