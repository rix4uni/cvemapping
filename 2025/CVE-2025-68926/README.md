# CVE-2025-68926 - RustFS Hardcoded gRPC Authentication Token

## Description

RustFS versions prior to 1.0.0-alpha.77 contain a hardcoded gRPC authentication token that allows unauthenticated access to all gRPC services. This vulnerability enables unauthorized file read/write operations and system information disclosure.

## Vulnerability Details

- **CVE**: CVE-2025-68926
- **Affected Versions**: < 1.0.0-alpha.77
- **Hardcoded Token**: `"rustfs rpc"`
- **CVSS**: TBD
- **Impact**: 
  - Unauthenticated access to all gRPC services
  - File read/write operations on all volumes
  - System information disclosure
  - Potential data exfiltration

## Technical Details

The vulnerability exists in the gRPC authentication middleware where a hardcoded token is used for service-to-service communication. The token is defined in:

- `rustfs/src/server/http.rs:651`
- `crates/protos/src/lib.rs:111`

Any client that presents the token `"rustfs rpc"` in the `authorization` metadata header is granted full access to all gRPC endpoints, including:

- `ReadAll` - Read arbitrary files from any volume
- `WriteAll` - Write arbitrary files to any volume
- `ListDir` - List directory contents
- `ListVolumes` - Enumerate all volumes
- `ServerInfo` - Retrieve server configuration and system information
- `GetOsInfo` - Get operating system information
- `GetSysConfig` - Get system configuration
- `GetMemInfo` - Get memory information
- `GetProcInfo` - Get process information

## Setup

### Prerequisites

- Go 1.21 or later
- Docker and Docker Compose

### Installation

```bash
# Install dependencies
go mod download

# Build the exploit
go build -o exploit main.go
```

### Launch Lab Environment

```bash
docker compose up -d
```

The vulnerable RustFS instance will be available on:
- S3 API: `localhost:19010`
- Console: `localhost:19011`

## Usage

### Run the Exploit

```bash
./exploit <host> <port>
```

Example:
```bash
./exploit localhost 19010
```

## Exploit Functionality

The exploit performs the following operations:

1. Connects to RustFS using the hardcoded gRPC token
2. Retrieves server information via `ServerInfo`
3. Discovers available disks dynamically from server response
4. Lists volumes on each discovered disk
5. Recursively explores directories to enumerate all files
6. Reads and displays file contents (JSON format when applicable)

## Files

- `main.go` - Main exploit code in Go using gRPC libraries directly
- `docker-compose.yml` - Lab environment setup
- `go.mod` - Go module dependencies

## Implementation Details

The exploit uses:
- `google.golang.org/grpc` for gRPC client connections
- `github.com/fullstorydev/grpcurl` for dynamic gRPC method invocation
- `github.com/vmihailenco/msgpack/v5` for MessagePack decoding
- Direct gRPC calls without external command execution

## Code Structure

The code follows clean architecture principles:
- DRY (Don't Repeat Yourself) - Functions are reusable
- Small, focused functions with single responsibilities
- Early returns for error handling
- Comprehensive error guards

## References

- Hardcoded token location: `rustfs/src/server/http.rs:651`
- Alternative location: `crates/protos/src/lib.rs:111`
- RustFS Repository: https://github.com/rustfs/rustfs

## License

This exploit is provided for educational and security research purposes only. Use responsibly and only on systems you own or have explicit permission to test.
