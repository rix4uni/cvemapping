# 취약점 분석 보고서: VS Code Go 확장 프로그램의 커맨드 인젝션 취약점

- **CVE-ID:** CVE-2025-68120
- **CWE-ID:** CWE-184 (불완전한 차단 목록)
- **패치 버전:** v0.52.1 이상
- **발견자:** CHOE ([LinkedIn](https://www.linkedin.com/in/wonwoo-choe-908b11390/))

---

## 1. 요약

Visual Studio Code Go 확장 프로그램에서 원격 코드 실행(RCE) 취약점이 발견되었습니다. 이 취약점은 신뢰할 수 없는 작업 공간(Untrusted Workspaces)에 대한 보안 경계인 VS Code의 '제한 모드(Restricted Mode)'를 우회합니다. 근본 원인은 `go.buildFlags`와 같은 특정 설정이 제한 모드에서 적절히 차단되지 않았기 때문입니다.

공격자는 `.vscode/settings.json` 파일에 악의적인 값을 포함한 프로젝트를 생성할 수 있습니다. 사용자가 이 프로젝트를 열고 `.go` 파일을 열면, 의도하지 않은 코드가 실행될 수 있습니다.

- **취약점 유형**: 원격 코드 실행(RCE)
- **영향받는 설정**: `go.buildFlags`, `go.testFlags`, `go.vetFlags` 등

## 2. 근본 원인 분석

이 취약점의 근본 원인은 **CWE-184 (불완전한 블랙리스트)**로 분류할 수 있습니다. 즉, 보안을 위해 특정 설정을 차단하도록 설계된 '블랙리스트'가 불완전하여 원격 코드 실행(RCE)이 가능해졌습니다.

### `package.json` 보안 설정의 누락

VS Code 확장 프로그램은 `package.json` 파일의 `capabilities.untrustedWorkspaces.restrictedConfigurations` 배열을 통해 제한 모드에서 무시되어야 할 설정을 정의합니다.

조사 결과, 명령 실행에 영향을 줄 수 있는 `go.buildFlags`, `go.testFlags` 등 여러 설정이 이 목록에서 누락되어 있었습니다. 이러한 설계 결함으로 인해 사용자가 작업 공간을 신뢰하지 않더라도 VS Code는 이러한 설정을 Go 확장 프로그램에 전달했습니다.

### 취약한 코드 경로

`go.buildFlags`가 제한되지 않았기 때문에, `extension/src/goBuild.ts`의 코드는 신뢰 검증 없이 악의적인 설정 값을 가져옵니다.

```typescript
// extension/src/goBuild.ts
export async function goBuild(
	// ...
	goConfig: vscode.WorkspaceConfiguration,
	// ...
): Promise<ICheckResult[]> {
	// ...
	const buildFlags: string[] = isTestFile
		? getTestFlags(goConfig)
		: Array.isArray(goConfig['buildFlags'])
		? [...goConfig['buildFlags']] // <-- 악의적인 페이로드가 여기서 수용됩니다.
		: [];
	const buildArgs: string[] = isTestFile ? ['test', '-c'] : ['build'];
	// ...
	buildArgs.push(...buildFlags);
	// ...
	return runTool(buildArgs.concat(/*...*/)); // <-- 악의적인 플래그와 함께 명령이 실행됩니다.
}
```

`goConfig['buildFlags']`에서 읽은 값은 검증 없이 `buildFlags` 배열에 추가되며, 최종적으로 `runTool` 함수를 통해 `go build` 명령의 인자로 전달됩니다.

## 3. 공격 시나리오

공격자는 Go 컴파일러의 `-toolexec` 플래그를 악용할 수 있습니다. 이는 컴파일러 호출을 임의의 명령으로 래핑하는 정당한 기능입니다.

1.  **준비**: 공격자가 프로젝트 내에 악의적인 `.vscode/settings.json` 파일을 생성합니다.
    ```json
    {
      "go.buildFlags": ["-toolexec=calc.exe"]
    }
    ```
2.  **전달**: 공격자가 이 프로젝트를 개발자에게 전달합니다. 예를 들어, 공개 GitHub 저장소에 호스팅합니다.
3.  **실행**:
    - 개발자가 VS Code에서 프로젝트 폴더를 엽니다.
    - VS Code가 폴더를 신뢰할지 묻습니다.
    - 개발자가 "아니오, 작성자를 신뢰하지 않습니다"를 선택하여 제한 모드로 진입합니다.
    - 개발자가 코드를 검토하기 위해 임의의 `.go` 파일을 엽니다.
    - Go 확장 프로그램이 활성화되고, `go.buildFlags`를 읽어 빌드 프로세스를 시작하며, `-toolexec` 플래그에 지정된 대로 즉시 `calc.exe`를 실행합니다.

### 공격 벡터 및 트리거

이 취약점은 여러 설정을 통해 트리거될 수 있지만, 실행 경로에 따라 위험도가 다릅니다.

-   **주요 벡터 (`go.buildFlags`)**: 즉각적인 실행 가능성이 높습니다. `.go` 파일을 여는 것만으로도 Go 언어 서버(`gopls`)가 자동으로 초기화되고 빌드 관련 작업을 수행하여 추가 사용자 작업 없이 코드가 실행될 수 있습니다.
-   **보조 벡터 (`go.testFlags`, `go.vetFlags`, `go.lintFlags` 등)**: 이러한 경로는 특정 사용자 작업이 필요하므로 발생 빈도가 상대적으로 낮지만, 여전히 보안 측면에서 고려해야 할 부분입니다. 이러한 설정은 사용자가 명시적으로 테스트를 실행하거나 "저장 시 vet" 또는 "저장 시 lint"와 같은 기능을 활성화한 경우에만 사용됩니다.

## 4. 대응 방안

Go 확장 프로그램 개발팀은 **v0.52.1**에서 이 취약점을 패치했습니다. 현재 Go 확장 프로그램은 제한 모드에서 완전히 비활성화되며, 이는 `package.json` 파일의 `capabilities.untrustedWorkspaces` 설정에 반영되어 있습니다:

```json
"untrustedWorkspaces": {
  "supported": false
}
```

이 접근 방식은 확장 프로그램의 어떤 부분도 신뢰할 수 없는 작업 공간에서 실행되지 않도록 하여 이 취약점과 유사한 위험을 근본적으로 차단합니다.

## 5. 영향

-   **보안 경계 우회**: 이 취약점은 VS Code의 작업 공간 신뢰 보안 모델을 우회하여, 사용자가 제한 모드를 선택하더라도 코드가 실행될 수 있도록 합니다.
-   **잠재적 위험**: 공격자는 개발자의 시스템 권한으로 코드를 실행할 수 있으며, 이는 민감한 데이터에 대한 접근이나 추가적인 시스템 침해로 이어질 수 있습니다. 이는 특히 오픈소스 프로젝트나 팀 환경에서의 공급망 공격과 관련이 있습니다.

**권장사항**: 모든 사용자는 이 취약점을 해결하기 위해 가능한 한 빨리 확장 프로그램을 최신 버전으로 업데이트해야 합니다.

## 6. 공개 타임라인

- **2024-12-02**: 취약점 발견 및 Google VRP에 보고
- **2024-12-05**: 초기 평가 - "실행 불가능(공격자가 피해자의 컴퓨터에 접근해야 함)"으로 분류
- **2024-12-05**: 이의 제기 제출 - 악의적인 저장소를 통한 원격 공급망 공격임을 명확히 설명
  - 공격자가 `.vscode/settings.json`이 포함된 악의적인 저장소를 호스팅
  - 피해자가 복제하여 제한 모드에서 열기
  - 피해자의 컴퓨터에 직접 접근 불필요
  - VS Code의 작업 공간 신뢰 보안 경계 우회
- **2024-12-06**: 이의 제기 승인 - 취약점 심각도 재평가
- **2024-12-18**: 패치 릴리스 (v0.52.1)
- **2024-12-29**: CVE-2025-68120 할당

## 7. 참고 자료

- https://www.cve.org/CVERecord?id=CVE-2025-68120
- https://nvd.nist.gov/vuln/detail/CVE-2025-68120
- https://pkg.go.dev/vuln/GO-2025-4249
- https://go.dev/cl/731200
- https://groups.google.com/g/golang-dev/c/CHG4qfcicBU/m/4tanFUymDQAJ
