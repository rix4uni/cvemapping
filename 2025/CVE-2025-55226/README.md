# CVE-2025-55226 Corrected Patch Check
The original patch check didn't find the registry entry on my Windows 10, I fixed it

## Original Patch Check

```powershell
# DetectWin32k.ps1 â€“ check for vulnerable win32k.sys
$target = 'Microsoft-Windows-GraphicsKernel'
$patchVersion = '6.0.22.7'   # Expected patched version

$regPath = "HKLM:\SYSTEM\CurrentControlSet\Services\$target"
$currentVer = Get-ItemProperty $regPath | Select-Object -ExpandProperty ImagePath
$kernelFile = Join-Path $env:SystemRoot \System32\win32k.sys
$fileVersion = (Get-ChildItem $kernelFile).VersionInfo.FileVersion

if ($fileVersion -ne $patchVersion) {
    Write-Output "vulnerable: $currentVer (actual=$fileVersion, expected=$patchVersion)" | Out-File -Encoding ascii .\report.csv
}

# Result: HKLM:\SYSTEM\CurrentControlSet\Services\Microsoft-Windows-GraphicsKernel path not found
```

## Corrected Patch / Driver version Check
```powershell
# DetectWin32k_Fixed.ps1
$targetFile = "win32k.sys"
# Note: Ensure this is the correct version you are looking for. 
# 6.0.x is Windows Vista/Server 2008. Windows 10/11 are 10.0.x.
$patchVersion = [Version]'6.0.22.7' 

# 1. Look directly in System32. No registry needed.
$kernelPath = Join-Path $env:SystemRoot "System32\$targetFile"

# 2. Check if file exists
if (-not (Test-Path $kernelPath)) {
    Write-Warning "File $targetFile not found at $kernelPath. (Note: Modern Windows uses win32kfull.sys and win32kbase.sys)"
    return
}

# 3. Get the file version safely
$fileVersionInfo = (Get-Item $kernelPath).VersionInfo
$currentVerStr = $fileVersionInfo.FileVersion
# Clean up version string to ensure it parses as a [Version] object (removes spaces/text)
try {
    $currentVer = [Version]($currentVerStr -split " ")[0]
} catch {
    Write-Error "Could not parse version from file: $currentVerStr"
    return
}

# 4. Compare Versions Correctly
# The original script used "-ne" (Not Equal). This is dangerous. 
# If your version is NEWER (e.g., 10.0.x), "Not Equal" would falsely say you are vulnerable.
# We check if Current is LESS THAN (<) Patch.

Write-Host "Checking $targetFile..."
Write-Host "Current Version: $currentVer"
Write-Host "Patched Version: $patchVersion"

if ($currentVer -lt $patchVersion) {
    # If Current is LOWER than Patch, we are vulnerable
    $status = "VULNERABLE"
    Write-Host "Result: $status" -ForegroundColor Red
    
    # Output to CSV
    "$status,$targetFile,$currentVer,$patchVersion" | Out-File -Encoding ascii -Append .\report.csv
} else {
    # If Current is EQUAL or HIGHER, we are safe
    $status = "PATCHED/SAFE"
    Write-Host "Result: $status" -ForegroundColor Green
}

# Result: Current Version: 10.0.19041.3996
```
