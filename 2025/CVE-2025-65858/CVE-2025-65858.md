# CVE-2025-65858 – Stored Cross-Site Scripting (XSS) in Calibre-Web

**Vulnerability Type:** Stored Cross-Site Scripting (XSS) – CWE-79
**Affected Component:** User management – username field
**Affected Endpoint:** `/ajax/listusers`
**Severity:** High
**Status:** Vulnerability confirmed, not patched (at time of writing)
**Tested Version:** `Calibre-Web-v0.6.25`


---

## 1. Summary

* A Stored Cross-Site Scripting (XSS) vulnerability exists in `Calibre-Web` within the user management feature.
* When an administrator creates a new user, the `username` field is stored without proper input validation or output encoding.
* Later, when the API endpoint `/ajax/listusers` is accessed, the stored payload is returned and rendered without sanitization, causing automatic JavaScript execution in the victim’s browser.
* This issue can be used to execute arbitrary JavaScript in the context of an authenticated admin session.

---

## 2. Affected Products

* `Calibre-Web` version `0.6.25`
* Possibly earlier versions that share the same user management and `/ajax/listusers` implementation.

---

## 3. Vulnerability Details

### 3.1 Root Cause

* The `username` field is stored as-is without server-side validation or sanitization.
* The `/ajax/listusers` endpoint returns user-supplied data directly.
* The frontend renders the `username` field into the DOM without HTML-encoding or escaping, allowing injected HTML/JavaScript to execute.

### 3.2 Vulnerable Endpoint

* `POST /admin/user/new`
* `GET /ajax/listusers`

The vulnerability is triggered when a previously stored malicious username is included in the response from `/ajax/listusers` and interpreted as HTML by the client.

---

## 4. Steps to Reproduce

### Step 1 – Login as Administrator

1.  Navigate to the login page.
2.  Log in: Use the default admin credentials:
* Username: admin
* Password: admin123

### Step 2 – Create a New User with Malicious Username

1.  Go to the “Admin” Page and press "Add New User" button.
2.  In the `Username` field, inject the following payload:
    ```html
    <img src=x onerror=alert('XSS')>
    ```
    <img width="1919" height="939" alt="image" src="https://github.com/user-attachments/assets/1f89904d-2d51-4c66-9cf9-9bfce60ca3f2" />


   
3.  Fill in the remaining required fields (e.g. password, email) and submit the form.

### Step 3 – Persistence of Payload

The application stores the malicious `Username` value in the database without sanitization.

### Step 4 – Trigger the Stored XSS

1.  Access the endpoint: `GET /ajax/listusers`

2.  The `alert('XSS')` dialog appears, confirming the Stored XSS.
    <img width="1919" height="940" alt="image" src="https://github.com/user-attachments/assets/e63516a5-36b6-48f8-9f52-84cd8853d95e" />


---

## 5. Impact

A successful exploitation of this vulnerability allows an attacker to execute arbitrary JavaScript in the victim’s browser in the context of the affected application.

Possible impacts include:

* Theft of session cookies or other sensitive information.
* Execution of privileged actions as the logged-in administrator.
* Modification of user accounts, roles, or application settings.
* Persistent injection of malicious content into the application UI.
* Use of XSS as a pivot point for more advanced attacks (e.g. CSRF chaining, credential theft).

Because this is stored XSS, any user (typically administrators) who views the user list or any page that consumes `/ajax/listusers` can be affected.

---

## 6. Proof of Concept (PoC)

**Malicious Username**
```html
<img src=x onerror=alert('XSS')>
```

## Affected Versions
- Confirmed: Calibre-Web 0.6.25

## Credits
Discovered by: Nguyễn Khánh Duy

