import http from "http";
import { createFileSessionStorage } from "@react-router/node";

const storage = createFileSessionStorage({
  dir: "./sessions",
  cookie: {
    name: "session",
    httpOnly: true,
    path: "/",
    sameSite: "lax",
    secrets: [] // unsigned cookie for demonstration
  }
});

http.createServer(async (req, res) => {
  const session = await storage.getSession(req.headers.cookie);
  session.set("demo", "vulnerable");

  const cookie = await storage.commitSession(session);
  console.log("[vulnerable] Set-Cookie:", cookie);

  res.setHeader("Set-Cookie", cookie);
  res.end("vulnerable ok");
}).listen(3000, () => {
  console.log("Vulnerable server on 3000");
});
