#!/bin/bash

echo ""
echo "============================================================"
echo "          CVE-2023-29360 C Compiler                        "
echo "============================================================"
echo ""

echo "[1/3] Cleaning..."
rm -f client.exe client.o

echo "[2/3] Checking files..."
ls -lh client.cpp Types.h

echo ""
echo "[3/3] Compiling (using C++ compiler)..."

# Compile with explicit console subsystem
x86_64-w64-mingw32-g++ \
    -o client.exe \
    client.cpp \
    -Wl,--subsystem,console \
    -static-libgcc \
    -static-libstdc++ \
    -lole32 \
    -lksuser \
    -lntdll \
    -D_UNICODE \
    -DUNICODE \
    -std=c++11 \
    -O2

if [ $? -eq 0 ]; then
    echo ""
    echo "============================================================"
    echo "[+] Compilation successful!"
    echo "============================================================"
    echo ""
    ls -lh client.exe
    file client.exe
    echo ""
    echo "[+] Ready to transfer to Windows target"
else
    echo ""
    echo "[-] Compilation failed"
    exit 1
fi

